{% extends 'base.html' %}
{% load analyser_tags %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'analyser/css/result.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Resume Analysis Results</h2>
    
    <!-- ML Prediction Section -->
    <div class="card mb-4">
        <div class="card-header">
            <h4>ML Prediction</h4>
        </div>
        <div class="card-body">
            <div class="alert {% if prediction == 'High' %}alert-success{% elif prediction == 'Medium' %}alert-warning{% else %}alert-danger{% endif %}">
                <h5>HR Interest: {{ prediction }}</h5>
                <p>Probability: {{ probability|floatformat:2 }}</p>
                <p>Skills Found: {{ skills_found }}</p>
            </div>
        </div>
    </div>

    <!-- Keyword Heatmap Section -->
    <div class="card mb-4">
        <div class="card-header">
            <h4>Keyword Analysis</h4>
        </div>
        <div class="card-body">
            <!-- Section Scores -->
            <h5>Section Relevance</h5>
            <div class="row mb-4">
                {% for section, data in keyword_analysis.section_analysis.items %}
                <div class="col-md-4 mb-3">
                    <div class="card section-card">
                        <div class="card-body">
                            <h6 class="card-title text-capitalize">{{ section }}</h6>
                            <div class="progress">
                                <div class="progress-bar" 
                                     role="progressbar" 
                                     data-width="{{ data.score|multiply:100 }}"
                                     style="--progress-width: {{ data.score|multiply:100 }}%"
                                     aria-valuenow="{{ data.score|multiply:100 }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                    {{ data.score|multiply:100 }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Keyword Relevance -->
            <h5>Keyword Relevance</h5>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Keyword</th>
                            <th>Status</th>
                            <th>Found In</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for keyword in keyword_analysis.keyword_relevance %}
                        <tr>
                            <td>{{ keyword.keyword }}</td>
                            <td>
                                {% if keyword.found %}
                                <span class="badge bg-success">Found</span>
                                {% else %}
                                <span class="badge bg-danger">Missing</span>
                                {% endif %}
                            </td>
                            <td>
                                {% for section in keyword.sections %}
                                <span class="badge bg-info">{{ section.name }} ({{ section.count }})</span>
                                {% endfor %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- TF-IDF Score Section -->
    <div class="card mb-4">
        <div class="card-header">
            <h4>Job Description Match</h4>
        </div>
        <div class="card-body">
            <div class="progress">
                <div class="progress-bar" 
                     role="progressbar" 
                     data-width="{{ tfidf_score|multiply:100 }}"
                     style="--progress-width: {{ tfidf_score|multiply:100 }}%"
                     aria-valuenow="{{ tfidf_score|multiply:100 }}" 
                     aria-valuemin="0" 
                     aria-valuemax="100">
                    {{ tfidf_score|multiply:100 }}%
                </div>
            </div>
        </div>
    </div>

    <!-- Resume Text Section -->
    <div class="card mb-4">
        <div class="card-header">
            <h4>Parsed Resume</h4>
        </div>
        <div class="card-body">
            <pre class="resume-text">{{ resume_text }}</pre>
        </div>
    </div>

    <!-- Job Description Section -->
    <div class="card mb-4">
        <div class="card-header">
            <h4>Job Description</h4>
        </div>
        <div class="card-body">
            <pre class="job-description">{{ job_description }}</pre>
        </div>
    </div>
</div>
{% endblock %}
